<template>
  <div class="finance-dashboard">
    <!-- Modern Header Section -->
    <div class="finance-header">
      <div class="header-content">
        <div class="header-left">
          <h1 class="page-title">
            <i class="bx bx-wallet me-2"></i>
            Qu·∫£n l√Ω T√†i ch√≠nh
          </h1>
          <p class="page-subtitle">Theo d√µi v√† qu·∫£n l√Ω t√†i ch√≠nh tr∆∞·ªùng m·∫ßm non</p>
        </div>
        <div class="header-right">
          <div class="breadcrumb-nav">
            <span class="breadcrumb-item">Admin</span>
            <i class="bx bx-chevron-right"></i>
            <span class="breadcrumb-item active">T√†i ch√≠nh</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Modern Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card revenue-card">
        <div class="stat-icon">
          <i class="bx bx-trending-up"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">124.5M</h3>
          <p class="stat-label">T·ªïng thu th√°ng</p>
          <div class="stat-change positive">
            <i class="bx bx-up-arrow-alt"></i>
            <span>+12.5%</span>
          </div>
        </div>
      </div>

      <div class="stat-card expense-card">
        <div class="stat-icon">
          <i class="bx bx-trending-down"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">60.8M</h3>
          <p class="stat-label">T·ªïng chi th√°ng</p>
          <div class="stat-change negative">
            <i class="bx bx-down-arrow-alt"></i>
            <span>-5.2%</span>
          </div>
        </div>
      </div>

      <div class="stat-card profit-card">
        <div class="stat-icon">
          <i class="bx bx-dollar"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">63.7M</h3>
          <p class="stat-label">L·ª£i nhu·∫≠n</p>
          <div class="stat-change positive">
            <i class="bx bx-up-arrow-alt"></i>
            <span>+18.3%</span>
          </div>
        </div>
      </div>

      <div class="stat-card students-card">
        <div class="stat-icon">
          <i class="bx bx-user"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">156</h3>
          <p class="stat-label">H·ªçc sinh ƒë√≥ng ph√≠</p>
          <div class="stat-change neutral">
            <i class="bx bx-minus"></i>
            <span>0%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <div class="chart-container main-chart">
        <div class="chart-header">
          <h3 class="chart-title">
            <i class="bx bx-line-chart me-2"></i>
            Bi·ªÉu ƒë·ªì thu chi theo th√°ng
          </h3>
          <div class="chart-controls">
            <select class="period-select">
              <option value="12">12 th√°ng</option>
              <option value="6">6 th√°ng</option>
              <option value="3">3 th√°ng</option>
            </select>
          </div>
        </div>
        <div class="chart-body">
          <canvas id="revenueChart"></canvas>
        </div>
      </div>

      <div class="chart-container pie-chart">
        <div class="chart-header">
          <h3 class="chart-title">
            <i class="bx bx-pie-chart me-2"></i>
            Ph√¢n b·ªï chi ph√≠
          </h3>
        </div>
        <div class="chart-body">
          <canvas id="expenseChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Additional Charts Section -->
    <div class="additional-charts">
      <div class="chart-container bar-chart">
        <div class="chart-header">
          <h3 class="chart-title">
            <i class="bx bx-bar-chart-alt-2 me-2"></i>
            Thu nh·∫≠p theo l·ªõp h·ªçc
          </h3>
        </div>
        <div class="chart-body">
          <canvas id="classRevenueChart"></canvas>
        </div>
      </div>

      <div class="chart-container area-chart">
        <div class="chart-header">
          <h3 class="chart-title">
            <i class="bx bx-trending-up me-2"></i>
            Xu h∆∞·ªõng tƒÉng tr∆∞·ªüng
          </h3>
        </div>
        <div class="chart-body">
          <canvas id="growthChart"></canvas>
        </div>
      </div>

      <div class="chart-container doughnut-chart">
        <div class="chart-header">
          <h3 class="chart-title">
            <i class="bx bx-doughnut-chart me-2"></i>
            T·ª∑ l·ªá h·ªçc sinh ƒë√≥ng ph√≠
          </h3>
        </div>
        <div class="chart-body">
          <canvas id="paymentStatusChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="statistics-section">
      <h3 class="section-title">
        <i class="bx bx-stats me-2"></i>
        Th·ªëng k√™ chi ti·∫øt
      </h3>

      <div class="stats-cards-grid">
        <div class="stat-card-small">
          <div class="stat-icon-small">
            <i class="bx bx-calendar"></i>
          </div>
          <div class="stat-info">
            <h4>Th√°ng n√†y</h4>
            <p class="stat-number">124.5M <span class="stat-trend positive">+12.5%</span></p>            
          </div>
        </div>

        <div class="stat-card-small">
          <div class="stat-icon-small">
            <i class="bx bx-calendar-check"></i>
          </div>
          <div class="stat-info">
            <h4>Th√°ng tr∆∞·ªõc</h4>
            <p class="stat-number">110.8M <span class="stat-trend positive">+8.2%</span></p>            
          </div>
        </div>

        <div class="stat-card-small">
          <div class="stat-icon-small">
            <i class="bx bx-trophy"></i>
          </div>
          <div class="stat-info">
            <h4>Th√°ng cao nh·∫•t</h4>
            <p class="stat-number">135.2M <span class="stat-trend neutral">T3/2024</span></p>            
          </div>
        </div>

        <div class="stat-card-small">
          <div class="stat-icon-small">
            <i class="bx bx-trending-up"></i>
          </div>
          <div class="stat-info">
            <h4>TƒÉng tr∆∞·ªüng TB</h4>
            <p class="stat-number">15.3% <span class="stat-trend positive">/th√°ng</span></p>            
          </div>
        </div>

        <div class="stat-card-small">
          <div class="stat-icon-small">
            <i class="bx bx-user-check"></i>
          </div>
          <div class="stat-info">
            <h4>T·ª∑ l·ªá ƒë√≥ng ph√≠</h4>
            <p class="stat-number">94.2% <span class="stat-trend positive">+2.1%</span></p>            
          </div>
        </div>

        <div class="stat-card-small">
          <div class="stat-icon-small">
            <i class="bx bx-time"></i>
          </div>
          <div class="stat-info">
            <h4>Trung b√¨nh/HS</h4>
            <p class="stat-number">2.8M <span class="stat-trend positive">+0.3M</span></p>            
          </div>
        </div>
      </div>
    </div>

    <!-- Financial Details -->
    <div class="details-section">
      <div class="detail-card">
        <div class="card-header">
          <h3 class="card-title">
            <i class="bx bx-receipt me-2"></i>
            Chi ti·∫øt thu h·ªçc ph√≠
          </h3>
          <button class="btn-icon">
            <i class="bx bx-dots-vertical-rounded"></i>
          </button>
        </div>
        <div class="card-body">
          <div class="table-container">
            <table class="modern-table">
              <thead>
                <tr>
                  <th>L·ªõp</th>
                  <th>S·ªë h·ªçc sinh</th>
                  <th>H·ªçc ph√≠/l·ªõp</th>
                  <th>T·ªïng thu</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <div class="class-info">
                      <div class="class-icon">üå±</div>
                      <span>L·ªõp M·∫ßm</span>
                    </div>
                  </td>
                  <td><span class="badge-count">25</span></td>
                  <td><span class="amount">2.5M</span></td>
                  <td><span class="total-amount success">62.5M</span></td>
                </tr>
                <tr>
                  <td>
                    <div class="class-info">
                      <div class="class-icon">üåø</div>
                      <span>L·ªõp Ch·ªìi</span>
                    </div>
                  </td>
                  <td><span class="badge-count">28</span></td>
                  <td><span class="amount">2.8M</span></td>
                  <td><span class="total-amount success">78.4M</span></td>
                </tr>
                <tr>
                  <td>
                    <div class="class-info">
                      <div class="class-icon">üå≥</div>
                      <span>L·ªõp L√°</span>
                    </div>
                  </td>
                  <td><span class="badge-count">30</span></td>
                  <td><span class="amount">3.0M</span></td>
                  <td><span class="total-amount success">90.0M</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="detail-card">
        <div class="card-header">
          <h3 class="card-title">
            <i class="bx bx-money me-2"></i>
            Chi ti·∫øt chi ph√≠
          </h3>
          <button class="btn-icon">
            <i class="bx bx-dots-vertical-rounded"></i>
          </button>
        </div>
        <div class="card-body">
          <div class="table-container">
            <table class="modern-table">
              <thead>
                <tr>
                  <th>Danh m·ª•c</th>
                  <th>S·ªë ti·ªÅn</th>
                  <th>T·ª∑ l·ªá</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <div class="expense-info">
                      <div class="expense-icon">üë©‚Äçüè´</div>
                      <span>L∆∞∆°ng gi√°o vi√™n</span>
                    </div>
                  </td>
                  <td><span class="expense-amount">45.6M</span></td>
                  <td><span class="percentage">75%</span></td>
                </tr>
                <tr>
                  <td>
                    <div class="expense-info">
                      <div class="expense-icon">‚öôÔ∏è</div>
                      <span>Chi ph√≠ v·∫≠n h√†nh</span>
                    </div>
                  </td>
                  <td><span class="expense-amount">15.2M</span></td>
                  <td><span class="percentage">25%</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Tuition Management Section -->
    <div class="tuition-management">
      <h3 class="section-title">
        <i class="bx bx-credit-card me-2"></i>
        Qu·∫£n l√Ω h·ªçc ph√≠
      </h3>

      <div class="tuition-cards">
        <div class="tuition-card">
          <div class="card-header">
            <h4 class="card-title">
              <i class="bx bx-user-check me-2"></i>
              H·ªçc ph√≠ theo h·ªçc sinh
            </h4>
            <button class="btn-add">
              <i class="bx bx-plus"></i>
            </button>
          </div>
          <div class="card-body">
            <div class="student-fee-list">
              <div class="student-fee-item">
                <div class="student-info">
                  <div class="avatar">A</div>
                  <div class="info">
                    <h5>Nguy·ªÖn VƒÉn An</h5>
                    <p>L·ªõp M·∫ßm - Th√°ng 12/2024</p>
                  </div>
                </div>
                <div class="fee-details">
                  <span class="fee-amount">2.5M</span>
                  <span class="fee-status paid">ƒê√£ ƒë√≥ng</span>
                </div>
              </div>
              <div class="student-fee-item">
                <div class="student-info">
                  <div class="avatar">B</div>
                  <div class="info">
                    <h5>Tr·∫ßn Th·ªã B√¨nh</h5>
                    <p>L·ªõp Ch·ªìi - Th√°ng 12/2024</p>
                  </div>
                </div>
                <div class="fee-details">
                  <span class="fee-amount">2.8M</span>
                  <span class="fee-status pending">Ch∆∞a ƒë√≥ng</span>
                </div>
              </div>
              <div class="student-fee-item">
                <div class="student-info">
                  <div class="avatar">C</div>
                  <div class="info">
                    <h5>L√™ VƒÉn C∆∞·ªùng</h5>
                    <p>L·ªõp L√° - Th√°ng 12/2024</p>
                  </div>
                </div>
                <div class="fee-details">
                  <span class="fee-amount">3.0M</span>
                  <span class="fee-status partial">C√≤n thi·∫øu</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="tuition-card">
          <div class="card-header">
            <h4 class="card-title">
              <i class="bx bx-calculator me-2"></i>
              T√≠nh to√°n h·ªçc ph√≠ t·ª± ƒë·ªông
            </h4>
          </div>
          <div class="card-body">
            <div class="fee-calculation">
              <div class="calculation-item">
                <span class="label">H·ªçc ph√≠ c∆° b·∫£n:</span>
                <span class="value">2.0M</span>
              </div>
              <div class="calculation-item">
                <span class="label">ƒÇn s√°ng:</span>
                <span class="value">+200K</span>
              </div>
              <div class="calculation-item">
                <span class="label">B√°n tr√∫:</span>
                <span class="value">+300K</span>
              </div>
              <div class="calculation-item">
                <span class="label">Xe ƒë∆∞a ƒë√≥n:</span>
                <span class="value">+150K</span>
              </div>
              <div class="calculation-item total">
                <span class="label">T·ªïng c·ªông:</span>
                <span class="value">2.65M</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Payment Methods Section -->
    <div class="payment-methods">
      <h3 class="section-title">
        <i class="bx bx-credit-card me-2"></i>
        Ph∆∞∆°ng th·ª©c thanh to√°n
      </h3>

      <div class="payment-cards">
        <div class="payment-card vnpay">
          <div class="payment-icon">
            <i class="bx bx-credit-card"></i>
          </div>
          <h4>VNPay</h4>
          <p>Thanh to√°n qua th·∫ª</p>
          <div class="payment-stats">
            <span class="amount">45.2M</span>
            <span class="count">156 giao d·ªãch</span>
          </div>
        </div>

        <div class="payment-card momo">
          <div class="payment-icon">
            <i class="bx bx-mobile"></i>
          </div>
          <h4>MoMo</h4>
          <p>V√≠ ƒëi·ªán t·ª≠</p>
          <div class="payment-stats">
            <span class="amount">32.8M</span>
            <span class="count">89 giao d·ªãch</span>
          </div>
        </div>

        <div class="payment-card zalopay">
          <div class="payment-icon">
            <i class="bx bx-mobile"></i>
          </div>
          <h4>ZaloPay</h4>
          <p>V√≠ ƒëi·ªán t·ª≠</p>
          <div class="payment-stats">
            <span class="amount">28.5M</span>
            <span class="count">67 giao d·ªãch</span>
          </div>
        </div>

        <div class="payment-card cash">
          <div class="payment-icon">
            <i class="bx bx-money"></i>
          </div>
          <h4>Ti·ªÅn m·∫∑t</h4>
          <p>Thanh to√°n tr·ª±c ti·∫øp</p>
          <div class="payment-stats">
            <span class="amount">18.0M</span>
            <span class="count">45 giao d·ªãch</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Expense Management Section -->
    <div class="expense-management">
      <h3 class="section-title">
        <i class="bx bx-receipt me-2"></i>
        Qu·∫£n l√Ω chi ph√≠ ho·∫°t ƒë·ªông
      </h3>

      <div class="expense-tabs">
        <button class="tab-btn active" data-tab="fixed">Chi ph√≠ c·ªë ƒë·ªãnh</button>
        <button class="tab-btn" data-tab="variable">Chi ph√≠ ph√°t sinh</button>
        <button class="tab-btn" data-tab="salary">L∆∞∆°ng nh√¢n vi√™n</button>
      </div>

      <div class="expense-content">
        <div class="tab-content active" id="fixed">
          <div class="expense-list">
            <div class="expense-item">
              <div class="expense-icon">‚ö°</div>
              <div class="expense-info">
                <h5>ƒêi·ªán</h5>
                <p>Th√°ng 12/2024</p>
              </div>
              <div class="expense-amount">2.5M</div>
              <div class="expense-status paid">ƒê√£ thanh to√°n</div>
            </div>
            <div class="expense-item">
              <div class="expense-icon">üíß</div>
              <div class="expense-info">
                <h5>N∆∞·ªõc</h5>
                <p>Th√°ng 12/2024</p>
              </div>
              <div class="expense-amount">800K</div>
              <div class="expense-status paid">ƒê√£ thanh to√°n</div>
            </div>
            <div class="expense-item">
              <div class="expense-icon">üåê</div>
              <div class="expense-info">
                <h5>Internet</h5>
                <p>Th√°ng 12/2024</p>
              </div>
              <div class="expense-amount">500K</div>
              <div class="expense-status pending">Ch∆∞a thanh to√°n</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="actions-section">
      <div class="action-buttons">
        <button class="action-btn primary">
          <i class="bx bx-plus"></i>
          <span>Th√™m kho·∫£n thu</span>
        </button>
        <button class="action-btn success">
          <i class="bx bx-download"></i>
          <span>Xu·∫•t b√°o c√°o</span>
        </button>
        <button class="action-btn info">
          <i class="bx bx-calendar"></i>
          <span>Xem l·ªãch s·ª≠</span>
        </button>
        <button class="action-btn warning">
          <i class="bx bx-cog"></i>
          <span>C√†i ƒë·∫∑t</span>
        </button>
      </div>
    </div>
  </div>
</template>

<script>
import { onMounted } from 'vue'
import Chart from 'chart.js/auto'

export default {
  name: 'TaiChinh',
  setup() {
    onMounted(() => {
      // Revenue Chart
      const revenueCtx = document.getElementById('revenueChart')
      if (revenueCtx) {
        new Chart(revenueCtx, {
          type: 'line',
          data: {
            labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
            datasets: [{
              label: 'Thu h·ªçc ph√≠',
              data: [95, 98, 102, 105, 110, 115, 118, 120, 122, 125, 128, 124.5],
              borderColor: 'rgb(75, 192, 192)',
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              tension: 0.4
            }, {
              label: 'Chi ph√≠',
              data: [55, 58, 60, 62, 65, 68, 70, 72, 75, 78, 80, 60.8],
              borderColor: 'rgb(255, 99, 132)',
              backgroundColor: 'rgba(255, 99, 132, 0.2)',
              tension: 0.4
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            aspectRatio: 2,
            plugins: {
              legend: {
                position: 'top',
              },
              title: {
                display: true,
                text: 'Thu chi theo th√°ng (tri·ªáu VNƒê)'
              }
            },
            scales: {
              y: {
                beginAtZero: true
              }
            },
            layout: {
              padding: {
                top: 20,
                bottom: 20,
                left: 20,
                right: 20
              }
            }
          }
        })
      }

      // Expense Chart
      const expenseCtx = document.getElementById('expenseChart')
      if (expenseCtx) {
        new Chart(expenseCtx, {
          type: 'doughnut',
          data: {
            labels: ['L∆∞∆°ng gi√°o vi√™n', 'Chi ph√≠ v·∫≠n h√†nh', 'C∆° s·ªü v·∫≠t ch·∫•t', 'Kh√°c'],
            datasets: [{
              data: [60, 20, 15, 5],
              backgroundColor: [
                'rgba(255, 99, 132, 0.8)',
                'rgba(54, 162, 235, 0.8)',
                'rgba(255, 206, 86, 0.8)',
                'rgba(75, 192, 192, 0.8)'
              ],
              borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)'
              ],
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            aspectRatio: 1,
            plugins: {
              legend: {
                position: 'bottom',
              }
            },
            layout: {
              padding: {
                top: 20,
                bottom: 20,
                left: 20,
                right: 20
              }
            }
          }
        })
      }

      // Class Revenue Chart
      const classRevenueCtx = document.getElementById('classRevenueChart')
      if (classRevenueCtx) {
        new Chart(classRevenueCtx, {
          type: 'bar',
          data: {
            labels: ['L·ªõp M·∫ßm', 'L·ªõp Ch·ªìi', 'L·ªõp L√°', 'L·ªõp T·ªïng h·ª£p'],
            datasets: [{
              label: 'Thu nh·∫≠p (tri·ªáu VNƒê)',
              data: [62.5, 78.4, 90.0, 45.2],
              backgroundColor: [
                'rgba(16, 185, 129, 0.8)',
                'rgba(59, 130, 246, 0.8)',
                'rgba(139, 92, 246, 0.8)',
                'rgba(245, 158, 11, 0.8)'
              ],
              borderColor: [
                'rgba(16, 185, 129, 1)',
                'rgba(59, 130, 246, 1)',
                'rgba(139, 92, 246, 1)',
                'rgba(245, 158, 11, 1)'
              ],
              borderWidth: 2,
              borderRadius: 8
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            aspectRatio: 2,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: 'rgba(0, 0, 0, 0.1)'
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            },
            layout: {
              padding: {
                top: 20,
                bottom: 20,
                left: 20,
                right: 20
              }
            }
          }
        })
      }

      // Growth Chart
      const growthCtx = document.getElementById('growthChart')
      if (growthCtx) {
        new Chart(growthCtx, {
          type: 'line',
          data: {
            labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
            datasets: [{
              label: 'TƒÉng tr∆∞·ªüng (%)',
              data: [5, 8, 12, 15, 18, 22, 25, 28, 30, 32, 35, 38],
              borderColor: 'rgba(16, 185, 129, 1)',
              backgroundColor: 'rgba(16, 185, 129, 0.1)',
              tension: 0.4,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            aspectRatio: 2,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: 'rgba(0, 0, 0, 0.1)'
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            },
            layout: {
              padding: {
                top: 20,
                bottom: 20,
                left: 20,
                right: 20
              }
            }
          }
        })
      }

      // Payment Status Chart
      const paymentStatusCtx = document.getElementById('paymentStatusChart')
      if (paymentStatusCtx) {
        new Chart(paymentStatusCtx, {
          type: 'doughnut',
          data: {
            labels: ['ƒê√£ ƒë√≥ng ph√≠', 'Ch∆∞a ƒë√≥ng ph√≠', 'Qu√° h·∫°n'],
            datasets: [{
              data: [156, 8, 2],
              backgroundColor: [
                'rgba(16, 185, 129, 0.8)',
                'rgba(245, 158, 11, 0.8)',
                'rgba(239, 68, 68, 0.8)'
              ],
              borderColor: [
                'rgba(16, 185, 129, 1)',
                'rgba(245, 158, 11, 1)',
                'rgba(239, 68, 68, 1)'
              ],
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            aspectRatio: 1,
            plugins: {
              legend: {
                position: 'bottom',
              }
            },
            layout: {
              padding: {
                top: 20,
                bottom: 20,
                left: 20,
                right: 20
              }
            }
          }
        })
      }
    })

    return {}
  }
}
</script>

<style scoped>
@import "./style.scss";
</style>
